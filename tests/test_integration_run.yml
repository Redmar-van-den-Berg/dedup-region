- name: integration-vanilla
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 10
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_config.yaml
      --snakefile Snakefile
  stderr:
    must_not_contain:
      - rror
  files:
    - path: sample1/concat/forward.fastq.gz
    - path: sample1/umi-trie/forward_dedup.fastq.gz
    - path: sample1/regions/sample1.bam
    - path: sample1/regions/sample1.bam.bai
    - path: sample1/regions/sample1.cov
      contains:
        - "chrM\t8218"
    - path: sample1/regions/sample1.dedup.bam
    - path: sample1/regions/sample1.dedup.bam.bai
    - path: sample1/regions/sample1.dedup.cov
      contains:
        - "chrM\t8218"
    - path: transcripts/ENST00000361851/sample1.before.cov
    - path: transcripts/ENST00000361851/sample1.before.avg.cov
    - path: transcripts/ENST00000361851/sample1.after.cov
    - path: transcripts/ENST00000361851/sample1.after.avg.cov
    # Test if the coverage graphs are generated
    - path: transcripts/ENST00000361851/sample1_ENST00000361851.html
    - path: transcripts/ENST00000387461/sample1_ENST00000387461.html

- name: integration-subsamples
  tags:
    - integration
  command: >
    snakemake
      --reason
      --printshellcmds
      --jobs 1
      --latency-wait 10
      --use-singularity --singularity-args ' --cleanenv --bind /tmp'
      --config pepfile=tests/pep/project_subsamples.yaml
      --snakefile Snakefile
  files:
    - path: sample1/concat/forward.fastq.gz
    - path: sample1/umi-trie/forward_dedup.fastq.gz
    - path: sample1/regions/sample1.bam
